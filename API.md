# üì° API Documentation - ALEX System

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–í—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints —Ç—Ä–µ–±—É—é—Ç –Ω–∞–ª–∏—á–∏—è cookie `auth_token` —Å –≤–∞–ª–∏–¥–Ω—ã–º JWT —Ç–æ–∫–µ–Ω–æ–º.

### POST /api/auth/login

–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É.

**Request:**
```json
{
  "email": "admin@alex.kz",
  "password": "Admin123!"
}
```

**Response (200):**
```json
{
  "success": true,
  "user": {
    "id": "uuid",
    "email": "admin@alex.kz",
    "name": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
    "role": "ADMIN"
  }
}
```

**Errors:**
- 400: –ù–µ–≤–µ—Ä–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- 401: –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å
- 403: –£—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞

---

### POST /api/auth/logout

–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã.

**Response (200):**
```json
{
  "success": true
}
```

---

### GET /api/auth/me

–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.

**Response (200):**
```json
{
  "success": true,
  "user": {
    "id": "uuid",
    "email": "admin@alex.kz",
    "name": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
    "role": "ADMIN"
  }
}
```

**Errors:**
- 401: –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

---

### POST /api/auth/register

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤).

**Request:**
```json
{
  "email": "newuser@alex.kz",
  "password": "Password123!",
  "name": "–ù–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
  "role": "PURCHASER"
}
```

**Response (201):**
```json
{
  "success": true,
  "user": {
    "id": "uuid",
    "email": "newuser@alex.kz",
    "name": "–ù–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
    "role": "PURCHASER",
    "createdAt": "2025-10-09T12:00:00Z"
  }
}
```

**Errors:**
- 400: –ù–µ–≤–µ—Ä–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- 403: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤
- 409: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

---

## –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### ADMIN (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –æ–ø–µ—Ä–∞—Ü–∏—è–º:
- `users.*` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `requests.*` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏
- `suppliers.*` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º–∏
- `quotes.*` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ö–ü
- `settings.update` - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `reports.*` - –û—Ç—á–µ—Ç—ã
- `audit.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä –∞—É–¥–∏—Ç–∞

### PURCHASER (–ó–∞–∫—É–ø—â–∏–∫)
- `requests.create`, `requests.read`, `requests.update`
- `suppliers.create`, `suppliers.read`, `suppliers.update`
- `quotes.read`, `quotes.update`
- `reports.read`

### MANAGER (–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å)
- `requests.read`, `requests.approve`
- `suppliers.read`
- `quotes.read`
- `reports.read`, `reports.export`

### VIEWER (–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å)
- `requests.read`
- `suppliers.read`
- `quotes.read`
- `reports.read`

---

## Middleware

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

Middleware –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å JWT —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –≤—Å–µ—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤.

**–ü—É–±–ª–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã:**
- `/login`
- `/api/auth/login`

**–ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã:**
–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
1. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
2. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω ‚Üí —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ + —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ `/login` ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/dashboard`
4. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º—É –º–∞—Ä—à—Ä—É—Ç—É ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ URL –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞

---

## –ê—É–¥–∏—Ç

–í—Å–µ –≤–∞–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `audit_logs`:

**–õ–æ–≥–∏—Ä—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
- `login` - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- `logout` - –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- `create_user` - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `create_request` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
- `approve_request` - –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏
- `reject_request` - –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏
- –ò –¥—Ä—É–≥–∏–µ...

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–∞:**
```json
{
  "id": "uuid",
  "userId": "uuid",
  "action": "login",
  "entity": "user",
  "entityId": "uuid",
  "details": {},
  "ipAddress": "192.168.1.1",
  "createdAt": "2025-10-09T12:00:00Z"
}
```

---

## –°–ª–µ–¥—É—é—â–∏–µ endpoints (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

### –ó–∞—è–≤–∫–∏
- `GET /api/requests` - –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫
- `POST /api/requests` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
- `GET /api/requests/:id` - –î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏
- `PUT /api/requests/:id` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏
- `DELETE /api/requests/:id` - –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏
- `POST /api/requests/:id/start-search` - –ó–∞–ø—É—Å–∫ –ø–æ–∏—Å–∫–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
- `POST /api/requests/:id/approve` - –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏

### –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏
- `GET /api/suppliers` - –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
- `POST /api/suppliers` - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- `GET /api/suppliers/:id` - –î–µ—Ç–∞–ª–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- `PUT /api/suppliers/:id` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- `DELETE /api/suppliers/:id` - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞

### –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- `GET /api/quotes` - –°–ø–∏—Å–æ–∫ –ö–ü
- `GET /api/quotes/:id` - –î–µ—Ç–∞–ª–∏ –ö–ü
- `POST /api/quotes/:id/parse` - –ü–∞—Ä—Å–∏–Ω–≥ –ö–ü
- `GET /api/requests/:id/compare` - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ö–ü

### –û—Ç—á–µ—Ç—ã
- `GET /api/reports/purchases` - –û—Ç—á–µ—Ç –ø–æ –∑–∞–∫—É–ø–∫–∞–º
- `GET /api/reports/suppliers` - –û—Ç—á–µ—Ç –ø–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º
- `GET /api/reports/analytics` - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# Database
DATABASE_URL=postgresql://user:password@localhost:5432/alex_db

# JWT
JWT_SECRET=your-secret-key
JWT_EXPIRES_IN=7d

# API Keys
OPENAI_API_KEY=sk-...
GOOGLE_API_KEY=...
GOOGLE_SEARCH_ENGINE_ID=...

# Email
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-password

# Limits
MAX_REQUESTS_PER_MONTH=1000
MAX_PARALLEL_TASKS=10
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `system_settings`:

| Key | Default | Description |
|-----|---------|-------------|
| max_requests_per_month | 1000 | –ú–∞–∫—Å–∏–º—É–º –∑–∞—è–≤–æ–∫ –≤ –º–µ—Å—è—Ü |
| max_parallel_tasks | 10 | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á |
| price_weight | 0.7 | –í–µ—Å —Ü–µ–Ω—ã –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ |
| delivery_weight | 0.2 | –í–µ—Å —Å—Ä–æ–∫–∞ –ø–æ—Å—Ç–∞–≤–∫–∏ |
| rating_weight | 0.1 | –í–µ—Å —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ |
| default_currency | KZT | –í–∞–ª—é—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| critical_deadline_hours | 48 | –ö—Ä–∏—Ç–∏—á–Ω—ã–π —Å—Ä–æ–∫ (—á–∞—Å—ã) |

---

## –û—à–∏–±–∫–∏

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫

```json
{
  "error": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"
}
```

### HTTP –∫–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è

- `200` - –£—Å–ø–µ—à–Ω–æ
- `201` - –°–æ–∑–¥–∞–Ω–æ
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `401` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `403` - –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω
- `404` - –ù–µ –Ω–∞–π–¥–µ–Ω–æ
- `409` - –ö–æ–Ω—Ñ–ª–∏–∫—Ç (–¥—É–±–ª–∏–∫–∞—Ç)
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

