# üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞ alexautozakup.kz

## –ß—Ç–æ –±—ã–ª–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ

1. ‚úÖ **docker-compose.yml** - –æ–±–Ω–æ–≤–ª–µ–Ω `NEXT_PUBLIC_APP_URL` –Ω–∞ `https://alexautozakup.kz`
2. ‚úÖ **.env** - –æ–±–Ω–æ–≤–ª–µ–Ω `NEXT_PUBLIC_APP_URL` –Ω–∞ `https://alexautozakup.kz`
3. ‚úÖ **API —Ä–æ—É—Ç—ã** - –∑–∞–º–µ–Ω–µ–Ω —Ö–∞—Ä–¥–∫–æ–¥ `localhost:3000` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. ‚úÖ **Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è reverse proxy –∏ SSL
5. ‚úÖ **Certbot** - –¥–æ–±–∞–≤–ª–µ–Ω –≤ docker-compose –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

## –®–∞–≥–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–µ–Ω–∞

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –∑–∞–ø–∏—Å–µ–π

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS –∑–∞–ø–∏—Å–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞ `alexautozakup.kz`:

**A-–∑–∞–ø–∏—Å—å:**
- –ò–º—è: `@` (–∏–ª–∏ `alexautozakup.kz`)
- –ó–Ω–∞—á–µ–Ω–∏–µ: IP –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- TTL: 3600 (–∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)

**A-–∑–∞–ø–∏—Å—å –¥–ª—è www:**
- –ò–º—è: `www`
- –ó–Ω–∞—á–µ–Ω–∏–µ: IP –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- TTL: 3600

**–ü—Ä–æ–≤–µ—Ä–∫–∞ DNS:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ DNS –∑–∞–ø–∏—Å–∏ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å
dig alexautozakup.kz
dig www.alexautozakup.kz
```

### 2. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ SSL)

–ü–µ—Ä–µ–¥ –ø–æ–ª—É—á–µ–Ω–∏–µ–º SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```bash
cd /root/alex

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ nginx-http.conf –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
cp nginx/nginx-http.conf nginx/nginx-temp.conf
mv nginx/nginx.conf nginx/nginx-https.conf.bak
mv nginx/nginx-temp.conf nginx/nginx.conf

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ nginx (–±–µ–∑ certbot)
docker-compose up -d postgres app nginx
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ DNS –∑–∞–ø–∏—Å–∏ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å, –ø–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ nginx –≤—Ä–µ–º–µ–Ω–Ω–æ
docker-compose stop nginx

# –ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
docker-compose run --rm certbot certonly \
  --webroot \
  --webroot-path=/var/www/certbot \
  --email –≤–∞—à-email@example.com \
  --agree-tos \
  --no-eff-email \
  -d alexautozakup.kz \
  -d www.alexautozakup.kz
```

**–í–∞–∂–Ω–æ:** –ó–∞–º–µ–Ω–∏—Ç–µ `–≤–∞—à-email@example.com` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π email!

### 4. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ HTTPS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –æ–±–Ω–æ–≤–∏—Ç–µ docker-compose.yml:

```bash
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ docker-compose.yml
# –í —Ä–∞–∑–¥–µ–ª–µ nginx volumes –∏–∑–º–µ–Ω–∏—Ç–µ:
# –ë—ã–ª–æ: - ./nginx/nginx-http.conf:/etc/nginx/conf.d/default.conf:ro
# –°—Ç–∞–ª–æ: - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf:ro

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
sed -i 's|nginx-http.conf:/etc/nginx/conf.d/default.conf|nginx.conf:/etc/nginx/conf.d/default.conf|' docker-compose.yml

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nginx
docker-compose up -d nginx
```

### 5. –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
```bash
nslookup alexautozakup.kz
dig alexautozakup.kz +short
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
```bash
curl -I https://alexautozakup.kz
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
```bash
openssl s_client -connect alexautozakup.kz:443 -servername alexautozakup.kz
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

Certbot –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤. –í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é:

```bash
docker-compose exec certbot certbot renew
docker-compose exec nginx nginx -s reload
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ nginx

- `nginx/nginx.conf` - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å SSL (HTTPS)
- `nginx/nginx-http.conf` - –≤—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è SSL (HTTP)

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ nginx
```bash
docker-compose logs -f nginx
```

### –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ nginx
```bash
docker-compose exec nginx nginx -s reload
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx
```bash
docker-compose exec nginx nginx -t
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
```bash
docker-compose exec certbot certbot certificates
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–æ—Ä—Ç—ã:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã –≤ —Ñ–∞–π—Ä–≤–æ–ª–µ:
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∫–∞
   sudo ufw status
   
   # –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   sudo ufw allow 80/tcp
   sudo ufw allow 443/tcp
   ```

2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
   - HTTP –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—Å—è –Ω–∞ HTTPS
   - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–∞–ª–∏–¥–Ω—ã–π
   - –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –æ–±–æ–∏–º –¥–æ–º–µ–Ω–∞–º: `alexautozakup.kz` –∏ `www.alexautozakup.kz`

3. **Email:** –£–∫–∞–∂–∏—Ç–µ —Ä–∞–±–æ—á–∏–π email –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ - –Ω–∞ –Ω–µ–≥–æ –ø—Ä–∏–¥—É—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### DNS –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è
```bash
# –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ DNS (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
sudo systemd-resolve --flush-caches

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–µ DNS —Å–µ—Ä–≤–µ—Ä—ã
dig @8.8.8.8 alexautozakup.kz
```

### –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ DNS –∑–∞–ø–∏—Å–∏ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 48 —á–∞—Å–æ–≤)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 80 –æ—Ç–∫—Ä—ã—Ç
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

### Nginx –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
docker-compose exec nginx nginx -t

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
docker-compose logs nginx
```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ
docker-compose ps app

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs app

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
docker-compose logs nginx | tail -20
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–æ–º–µ–Ω –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–æ–º–µ–Ω—ã:

1. –û–±–Ω–æ–≤–∏—Ç–µ `NEXT_PUBLIC_APP_URL` –≤ `.env` –∏ `docker-compose.yml`
2. –û–±–Ω–æ–≤–∏—Ç–µ `server_name` –≤ `nginx/nginx.conf`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:
   ```bash
   docker-compose down
   docker-compose up -d
   ```

