// –ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Assistant —á–µ—Ä–µ–∑ fetch
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function createAssistant() {
  try {
    console.log('ü§ñ –°–æ–∑–¥–∞–µ–º Assistant —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π API –≤—ã–∑–æ–≤...')

    const apiKey = process.env.OPENAI_API_KEY
    if (!apiKey) {
      throw new Error('OPENAI_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω')
    }

    const response = await fetch('https://api.openai.com/v1/assistants', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${apiKey}`,
        'Content-Type': 'application/json',
        'OpenAI-Beta': 'assistants=v2'
      },
      body: JSON.stringify({
        name: "–°–∞–Ω–∂–∞—Ä - –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –∑–∞–∫—É–ø–∫–∞–º",
        instructions: `–¢—ã - –°–∞–Ω–∂–∞—Ä, –æ–ø—ã—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –∑–∞–∫—É–ø–∫–∞–º –∫–æ–º–ø–∞–Ω–∏–∏ –¢–û–û "Alex" –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ.

–¢–í–û–Ø –ì–õ–ê–í–ù–ê–Ø –¶–ï–õ–¨: –ü–æ–ª—É—á–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ —á–µ—Ä–µ–∑ WhatsApp –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã.

–°–¢–ò–õ–¨ –û–ë–©–ï–ù–ò–Ø:
- –ò—Å–ø–æ–ª—å–∑—É–π —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Å—Ç–∏–ª—å WhatsApp (–∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è, —ç–º–æ–¥–∑–∏)
- –û–±—Ä–∞—â–∞–π—Å—è –Ω–∞ "–í—ã" –∫ –Ω–æ–≤—ã–º –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º
- –î–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è: 1-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º—É–º
- –ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ –ø–æ –¥–µ–ª—É

–°–¢–†–ê–¢–ï–ì–ò–Ø:
1. üéØ –ì–õ–ê–í–ù–û–ï: –ü–æ–ª—É—á–∏—Ç—å –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å —Ü–µ–Ω–∞–º–∏, —Å—Ä–æ–∫–∞–º–∏, —É—Å–ª–æ–≤–∏—è–º–∏
2. üí¨ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π –∂–∏–≤–æ–π –¥–∏–∞–ª–æ–≥, –∑–∞–¥–∞–≤–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
3. üí∞ –ò–Ω—Ç–µ—Ä–µ—Å—É–π—Å—è —Å–∫–∏–¥–∫–∞–º–∏ –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö
4. üöö –£—Ç–æ—á–Ω—è–π —Å—Ä–æ–∫–∏ –ø–æ—Å—Ç–∞–≤–∫–∏ –∏ —É—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏
5. üí≥ –í—ã—è—Å–Ω—è–π —É—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã

–ü–†–ò–ú–ï–†–´ –û–¢–í–ï–¢–û–í:
- "–ü—Ä–∏–≤–µ—Ç! –ù—É–∂–Ω–æ –º–∞—Å–ª–æ –º–æ—Ç–æ—Ä–Ω–æ–µ 200–ª. –ö–∞–∫–∏–µ —Ü–µ–Ω—ã? üöó"
- "–û—Ç–ª–∏—á–Ω–æ! –ê –∫–∞–∫–∏–µ —Å—Ä–æ–∫–∏ –ø–æ—Å—Ç–∞–≤–∫–∏? –ó–∞—è–≤–∫–∞ —Å—Ä–æ—á–Ω–∞—è ‚è∞"
- "–•–æ—Ä–æ—à–æ. –ï—Å—Ç—å —Å–∫–∏–¥–∫–∏ –æ—Ç 500–ª? –û–±—ä–µ–º—ã –±–æ–ª—å—à–∏–µ üìà"
- "–ü–æ–Ω—è–ª. –ñ–¥—É –ö–ü –Ω–∞ –ø–æ—á—Ç—É –∏–ª–∏ –º–æ–∂–µ—Ç–µ –∑–¥–µ—Å—å –ø—Ä–∏—Å–ª–∞—Ç—å? üìß"

–ü–æ–º–Ω–∏: —Ç—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—à—å —Å–µ—Ä—å–µ–∑–Ω—É—é –∫–æ–º–ø–∞–Ω–∏—é —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º–∏ –æ–±—ä–µ–º–∞–º–∏ –∑–∞–∫—É–ø–æ–∫!`,
        model: "gpt-4o-mini",
        temperature: 0.7
      })
    })

    if (!response.ok) {
      const error = await response.text()
      throw new Error(`API Error: ${response.status} - ${error}`)
    }

    const assistant = await response.json()
    console.log(`‚úÖ Assistant —Å–æ–∑–¥–∞–Ω: ${assistant.id}`)
    console.log(`üìù –ò–º—è: ${assistant.name}`)

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    await prisma.systemSetting.upsert({
      where: { key: 'openai_assistant_id' },
      update: {
        value: assistant.id,
        type: 'string',
        updatedAt: new Date()
      },
      create: {
        key: 'openai_assistant_id',
        value: assistant.id,
        type: 'string'
      }
    })

    console.log(`üíæ Assistant ID —Å–æ—Ö—Ä–∞–Ω–µ–Ω: ${assistant.id}`)
    console.log('\nüéâ Assistant "–°–∞–Ω–∂–∞—Ä" –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!')

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error)
  } finally {
    await prisma.$disconnect()
  }
}

createAssistant()
